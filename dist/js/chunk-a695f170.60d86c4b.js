(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a695f170"],{"03d6":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAADkklEQVRoge3YT4jVVRQH8I86QzFqpBVhmUnhTDYURGUQ/aGgFIpaVbgIEZw2Zc2ibNOfRYtqWYskamstKgnaSCOkLrKkXWFmi5AS08xqmsg3ZrY4d/D3fu/35v35vfdmoPeFw/vx+91zzvfed++55xz66KOPPvr4P2NBB20txO14CLfielyEf3ESR7APE+n3XAd9l8JCbMJBQaoZOYgtSXdOMYwvNU88L/sx2nPWCffj9wYEm5HJZKunWI+/C8hU8B4ewWpciMW4FhuxA9MFetPY0CvyaxSv/Ee4ugn9VfigQP83jHSBrzV4EbtwWKxy1vFZPNOG3a0iQuXPRMci4y3Yq/Eebof8DJ4usPd4CXtgEG+JlW1EfmdZZ/g4Z/PrMsYuxm6NiZ/DFK4s4yxhNc7kbN/WjqFB7FFM9lNx8YyIqHIBlpaiXY38oT6NQ+Lf2SwWtiHeLCD+He7qINF62FTgOyt/4HmxcIVYpzYi7MWybrLO4BqzT2BGvsCKIgMTale+V+SJnOgvzU3iB1yeVV5bMKgX2yaPe3GDOFvLxa54FacK+O0XZxaxt/IHdj5hmeBU9/7Jh80tvefYEAMiE8jy/BVDRHqQ/dCVfKQDWIFjqrk+Cn/mXnYyvncaS7ENxwXXHUQ+np3Akrli1wKG8BoOLBAhczjz8br0rhtYJNKEe3Bz8nuF84s2haNiW3+Fz3BA3FFFuJHaO2CsC8Svwuv4SW00aSQ/inC6sp7xbTmFiQ4SvxRvq60h2pEKtuOSvJORgsF3d4D8RhHqyhLPy0k8lneWvwsOi9uwHQyKVa9HYFLUzWPitr0s6Qym53V4Au+rDTBZ2S7uB8SByidz+9qcxId1HB7Dk9Ll0ySGks7PdWxWFVRF6fT3ImK0gvtUdywqeEm58LwEL6s+SxU8mB00oH41tlv8rWubJPJAcnAcd5QgnsedyWZFtDBr0EpJOSOncFOBrfWihVKEVaIrsUtUXlNJDqV3T4nQW0931h7SAN7QXFE/I7+IVLgRVuJd/NOEzTN4R4m6exSftDCJE6IjXQ8btNeKnMTD7U6CaGw9J3Lyb9Umf1k5KsrDIhtFLcVmZTrZmFNsVr0tvxFFyajodCxOz+Pp28y4s0l3XmBMtEy2isSuHhalMad1JzcrhcKuQgfG9tEOhkU6MJlkp3lwWFvBuNqIMz6njNrAs86Tf6FV5dkiQa/wuSC/B6+0qvwffjkFRrMuYVoAAAAASUVORK5CYII="},"21a2":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticStyle:{padding:"0"},attrs:{"fill-height":"",fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{"justify-center":"",wrap:""}},[a("baidu-map",{style:{width:e.width,height:e.height},attrs:{"scroll-wheel-zoom":"",center:e.center,zoom:e.zoom},on:{ready:e.mapReady,click:e.clickMap}},[a("bm-control",[a("div",[a("v-text-field",{ref:"searchRef",staticClass:"purple-input",attrs:{label:"搜索地点","prepend-inner-icon":"mdi-magnify",outlined:"",rounded:""},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),a("bm-local-search",{attrs:{panel:!!e.keyword,keyword:e.keyword}})],1)]),e._l(e.devList,(function(t){return a("bm-marker",{key:t.idx,staticClass:"BM_Marker",attrs:{position:t.position,animation:t.status?"BMAP_ANIMATION_BOUNCE":"",icon:{url:t.status?e.imgOn:e.imgOff,size:{height:45,width:55}}},on:{click:function(a){return e.devClick(t)}}})})),a("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","show-address-bar":!0,"auto-location":!0},on:{locationSuccess:e.locationSuccess}})],2)],1)],1)},s=[],o=(a("d81d"),a("03d6")),r=a.n(o),c=a("6766"),n=a.n(c),d={props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"}},data:function(){return{imgOn:r.a,imgOff:n.a,keyword:"",center:{lng:106,lat:29},zoom:6,devList:[{idx:0,position:{lng:100,lat:20},status:!0,data:[]},{idx:1,position:{lng:106.53,lat:29.54},status:!1,data:[]},{idx:2,position:{lng:106.53063501,lat:29.54460611},status:!0,data:[]}]}},methods:{mapReady:function(e){var t=this,a=e.BMap,i=e.map;if(this.$store.state.mobile){var s={};i.addEventListener("touchstart",(function(e){s.e=e.changedTouches?e.changedTouches[0]:e,s.target=e.target,s.time=Date.now(),s.X=s.e.pageX,s.Y=s.e.pageY})),i.addEventListener("touchend",(function(e){s.e=e.changedTouches?e.changedTouches[0]:e,s.target===e.target&&Date.now()-s.time<750&&Math.sqrt(Math.pow(s.X-s.e.pageX,2)+Math.pow(s.Y-s.e.pageY,2))<15&&t.clickMap(e)}))}var o=new a.Geolocation;this.$store.commit("setMapInstance",{map:i,BMap:a}),o.getCurrentPosition((function(e){if(0===o.getStatus()){t.center=e.point;var a=e.point,i=a.lat,s=a.lng;t.zoom=15,t.$store.position=i+","+s}else t.$message.error("定位失败")}),{enableHighAccuracy:!0})},devClick:function(e){this.$message.success("handel k")},locationSuccess:function(e,t,a){console.log(e,t,a)},clickMap:function(e){var t=this;this.$refs.searchRef.blur(),this.keyword="";var a=this.$store.state.mapInstance,i=a.map,s=a.BMap,o=e.point,r=this.$store.state.lastMarker,c=new s.Geocoder;i.removeOverlay(r);var n=new s.Marker(o);c.getLocation(o,(function(e){var a=e.addressComponents,i=a.city,s=a.district,o=a.street,r=a.streetNumber;t.$store.commit("setLocation",i+s+o+r)})),i.addOverlay(n),this.$store.commit("setSelectPoint",o),this.$store.commit("setLastMarker",n)}}},l=d,v=a("2877"),u=a("6544"),h=a.n(u),m=a("a523"),f=(a("20f6"),a("e8f2")),p=Object(f["a"])("layout"),g=a("8654"),b=Object(v["a"])(l,i,s,!1,null,null,null);t["a"]=b.exports;h()(b,{VContainer:m["a"],VLayout:p,VTextField:g["a"]})},6766:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAADK0lEQVRoge3ZzatVVRjH8c89XvMtX6AyzM5AQaWUIE2xEhoEvUyqQcNEu5YUlFCQjYL6Awxy0CgibFBeHRQkRRr0Al2KBmap5MCXwhfoVjdvkpl1G6wl7Lvv2efuu/c+L+H5wcPZsNd61netvdfzPGsfeuqpp556uprVV6GvGu7CQ1iLWzEP/2IYp/A59sffsQrHLqUaNuGIAJXHjuCJ2LejWo6v5AdP2xBWtp066j6MTAKYx85HX23V/fizJHjSLuGBdsEvU83Kp+03rGgV8Ev4CMfwVwvgk3uissh4Bz5rIWyWbSwLPh2v458OwI/huzLwc/Fhh8CTtq4I/HR82gXwY7iIH/AeNmNBngns7ALwLBvBdszIgl8r1CydBp3MhrCo0QT2dwFcXjuOhUn4W7oAaqr2JfoJ1eDDjR5Jl+tOPE3Iegdwb5sGPoNP8A0OC2eEX/A7ZuK6aDdiNe6O1igK/YqbCeVBKx/3OezA7YqVCTWsxxv4I+X7URhtEfhxPKlJ6Cug+XgGZ+MYuwj1eJXgF/BixeBpzcOrGOoTMt7yihx/LRRjxzLu13Ab7sEGLMX10Qhn559xAl8IZ+dDQo5qpCVUlwPelr3qi/GKsImn6vcMXsZNGb5trwD+NY036EK8hb8rGOMS3sQN6UFWlHR8ENNSPvvwuBAiqw4Ow9H3uAU7UMLhYyn42Rhs0n4Eu/GsUDbXY5/Z8XpdvDeo+dF1MPYBaxQv5tLv5t6Mdt8LYXWO/JqDrULSa+Rzb7Jx0XL6mtSg6bxyHs+JtUtB9eP5Br5H042KvEqLU4PtSdw7KIa6irQk+rzif0+6wYICk0gfwmdgCwYwKwOkLiS7ffhRSH4X4vW+eK+e0XdW9D0gI2z3C2Ex76H+WxOjUJbqwga+nMPvZbzbZCKTarX8SS4rDyT1iGJ116iSJf8yvICPcbQJxG4T90NSpwvAX7GfykygKp0yHuqQEO9X4tpoq7BN+DaUbHuy/bgT9aCwkifwlOb/DdSEE9dpAb7tX697+r+ojneEAm04XhcOm53QFhMjzkBHiaaoacaXHu8rVzN1RDOF8uGDeD0l/Qf4flguoyo9QwAAAABJRU5ErkJggg=="},"78a0":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{"fill-height":""}},[a("v-row",{attrs:{justify:"center"}},[a("v-col",{attrs:{cols:"12",md:"8"}},[a("v-data-table",{staticClass:"elevation-2",attrs:{headers:e.headers,items:e.devices,"sort-by":"id","fixed-header":"",height:"60vh","no-data-text":"请新建设备"},scopedSlots:e._u([{key:"top",fn:function(){return[a("v-toolbar",{attrs:{flat:"",color:"white"}},[a("v-dialog",{attrs:{"max-width":"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[a("v-btn",e._g({staticClass:"mb-2",attrs:{color:"primary",dark:""}},i),[e._v(" 新建设备 ")])]}}]),model:{value:e.dialogName,callback:function(t){e.dialogName=t},expression:"dialogName"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v(e._s(e.formTitle))])]),a("v-card-text",[a("v-text-field",{attrs:{label:"设备名称","error-messages":e.errorMsg},model:{value:e.editedDevice.deviceName,callback:function(t){e.$set(e.editedDevice,"deviceName",t)},expression:"editedDevice.deviceName"}})],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.addDevice}},[e._v(" 确定 ")])],1)],1)],1),a("v-dialog",{attrs:{"max-width":"500px",scrollable:""},on:{"click:outside":e.close},model:{value:e.dialogForm,callback:function(t){e.dialogForm=t},expression:"dialogForm"}},[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-card",[a("v-card-title",[e._v(" "+e._s(e.switch1?"新建":"编辑")+"从机 "),a("v-row",[a("v-col",{attrs:{cols:"5"}},[a("v-switch",{attrs:{label:"新建从机"},model:{value:e.switch1,callback:function(t){e.switch1=t},expression:"switch1"}})],1),a("v-col",{attrs:{cols:"7"}},[a("v-select",{attrs:{disabled:e.switch1,items:e.editedDevice.slavers,"item-text":"slaverName","return-object":"",label:"选择要修改的从机",rules:[function(t){return!!e.switch1||(!!t||"从机不能为空")}]},on:{change:e.changeSelect}})],1)],1)],1),a("v-card-text",[a("v-container",[a("v-row",{attrs:{justify:"center"}},[a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"设备名称",required:"",rules:[function(e){return!!e||"名字不能为空"},function(e){return e&&e.length<=6||"名字不能超过10个字符"}]},model:{value:e.editedDevice.deviceName,callback:function(t){e.$set(e.editedDevice,"deviceName",t)},expression:"editedDevice.deviceName"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"8"}},[a("v-select",{attrs:{"no-data-text":"请添加模板",items:e.$store.state.templates,"item-text":"templateName","item-value":"id",label:"绑定模板","return-object":"",rules:[function(e){return!!e||"请选择数据模板"}]},on:{change:e.selectTemplate},model:{value:e.tS,callback:function(t){e.tS=t},expression:"tS"}})],1),a("v-col",{attrs:{cols:"12",md:"4"}},[a("v-text-field",{attrs:{label:"从机名称",rules:[function(e){return!!e||"名字不能为空"},function(e){return e&&e.length<=6||"名字不能超过6个字符"}]},model:{value:e.editedSlaver.slaverName,callback:function(t){e.$set(e.editedSlaver,"slaverName",t)},expression:"editedSlaver.slaverName"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("v-text-field",{attrs:{label:"从机地址",type:"number"},model:{value:e.editedSlaver.slaverIndex,callback:function(t){e.$set(e.editedSlaver,"slaverIndex",t)},expression:"editedSlaver.slaverIndex"}})],1),a("v-col",{attrs:{cols:"12",md:"4"}},[a("v-text-field",{attrs:{label:"设备ID",rules:[function(e){return 8===e.length||"设备ID长度为8位"}]},model:{value:e.editedDevice.devID,callback:function(t){e.$set(e.editedDevice,"devID",t)},expression:"editedDevice.devID"}})],1),a("v-col",{attrs:{cols:"8"}},[a("v-text-field",{attrs:{label:"设备地址"},model:{value:e.location,callback:function(t){e.location=t},expression:"location"}})],1),a("v-col",{attrs:{cols:"4"}},[a("v-bottom-sheet",{scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[a("v-btn",e._g({attrs:{color:"orange",dark:""}},i),[e._v(" 打开地图 ")])]}}]),model:{value:e.sheet,callback:function(t){e.sheet=t},expression:"sheet"}},[a("v-sheet",{staticClass:"text-center",attrs:{height:e.$store.state.mobile?"60vh":"30vh"}},[a("myMaps")],1)],1)],1)],1)],1)],1),a("v-card-actions",[a("v-btn",{attrs:{color:"success darken-1",text:""},on:{click:e.commit}},[e._v(" 提交 ")]),a("v-spacer"),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.save}},[e._v(" 保存修改 ")]),a("v-btn",{attrs:{color:"error darken-1",text:""},on:{click:e.close}},[e._v(" 取消 ")])],1)],1)],1)],1)],1)]},proxy:!0},{key:"item.actions",fn:function(t){var i=t.item;return[a("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(i)}}},[e._v(" mdi-pencil ")]),a("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.deleteItem(i)}}},[e._v(" mdi-delete ")])]}}])})],1),a("v-col",{attrs:{cols:"12",md:"4"}},[a("v-card",[a("v-img",{staticClass:"white--text align-end",attrs:{height:"200px",src:"https://cdn.vuetifyjs.com/images/cards/docks.jpg"}},[a("v-card-title",[e._v(" 操作说明 ")])],1),a("v-card-text",[a("span",[e._v("设备ID:填写8位数字。")]),a("br"),a("br"),a("v-divider"),a("span",[e._v("从机地址:填写Modbus协议的从机地址数字。")]),a("br"),a("br"),a("v-divider"),a("span",[e._v("设备地址:点击打开地图从地图上选取，也可以手动输入。")]),a("v-divider")],1)],1)],1)],1)],1)},s=[],o=(a("c975"),a("d81d"),a("a434"),a("5530")),r=a("21a2"),c={components:{myMaps:r["a"]},data:function(){return{dialogName:!1,sheet:!1,tS:{},valid:!1,dialogForm:!1,editedDeviceIndex:-1,editedtSlaverIndex:-1,switch1:!1,editedSlaver:{slaverName:""},editedDevice:{slavers:[],deviceName:"",devID:""},headers:[{text:"设备ID",align:"start",value:"devID",sortable:!1},{text:"名称",value:"deviceName",sortable:!1},{text:"修改时间",value:"updatedAt",sortable:!1},{text:"操作",value:"actions",sortable:!1}]}},computed:{location:{set:function(e){this.$store.commit("setLocation",e)},get:function(){return this.$store.state.location}},formTitle:function(){return-1===this.editedDeviceIndex?"新建设备":"编辑设备"},errorMsg:function(){return this.editedDevice.deviceName?"":"名称不能为空"},devices:function(){return this.$store.state.devices}},watch:{dialog:function(e){e||this.close()}},created:function(){this.$store.dispatch("getTemplate"),this.$store.dispatch("getDevice")},methods:{addDevice:function(){var e=this;this.editedDeviceIndex=-1,this.editedSlaverIndex=-1,this.editedSlaver=Object.assign({slaverName:""}),this.editedDevice.deviceName&&(this.devices.map((function(t,a){if(t.deviceName===e.deviceName)return e.$msg({color:"error",content:"设备名称已存在"})})),this.$msg({color:"info",content:"请继续添加从机"}),this.dialogName=!1,this.switch1=!0,setTimeout((function(){e.dialogForm=!0}),200))},selectTemplate:function(e){this.editedSlaver.templateID=e.id,this.editedSlaver.templateName=e.templateName},editItem:function(e){this.editedDeviceIndex=this.devices.indexOf(e),this.editedDevice=Object.assign({},e),this.dialogForm=!0},changeSelect:function(e){this.editedSlaver=Object.assign({},e),this.tS=Object.assign({id:e.templateID,templateName:e.templateName}),this.$store.commit("setLocation",this.editedDevice.addr),this.$store.state.position=this.editedDevice.position,this.editedtSlaverIndex=this.editedDevice.slavers.indexOf(e)},deleteItem:function(e){confirm("确定删除 ".concat(e.deviceName," 吗?"))&&this.$store.dispatch("deleteDevice",{call:this,v:e})},commit:function(){if(this.editedDeviceIndex>=0)return this.$store.dispatch("putDevice",this);this.$store.dispatch("postDevice",this),this.close()},close:function(){this.dialogForm=!1,this.editedSlaver=Object.assign({slaverName:""}),this.editedDevice=Object.assign({slavers:[],deviceName:"",devID:""}),this.editedDeviceIndex=-1,this.switch1=!1},save:function(){this.$refs.form.validate()&&(this.editedDevice.position=this.$store.state.position,this.editedDevice.addr=this.location,this.editedSlaver.slaverIndex=parseInt(this.editedSlaver.slaverIndex),this.switch1?this.editedDevice.slavers.push(Object(o["a"])({},this.editedSlaver)):this.editedDevice.dataPoints.splice(this.editedtSlaverIndex,1,Object(o["a"])({},this.editedSlaver))),this.switch1=!1}}},n=c,d=a("2877"),l=a("6544"),v=a.n(l),u=(a("a9e3"),a("d0cd"),a("169a")),h=u["a"].extend({name:"v-bottom-sheet",props:{inset:Boolean,maxWidth:{type:[String,Number],default:"auto"},transition:{type:String,default:"bottom-sheet-transition"}},computed:{classes:function(){return Object(o["a"])({},u["a"].options.computed.classes.call(this),{"v-bottom-sheet":!0,"v-bottom-sheet--inset":this.inset})}}}),m=a("8336"),f=a("b0af"),p=a("99d9"),g=a("62ad"),b=a("a523"),x=a("8fea"),w=a("ce7e"),A=a("4bd4"),D=a("132d"),S=a("adda"),k=a("0fd9"),y=a("b974"),I=a("8dd9"),N=a("2fa4"),O=a("b73d"),V=a("8654"),B=a("71d9"),C=Object(d["a"])(n,i,s,!1,null,null,null);t["default"]=C.exports;v()(C,{VBottomSheet:h,VBtn:m["a"],VCard:f["a"],VCardActions:p["a"],VCardText:p["b"],VCardTitle:p["c"],VCol:g["a"],VContainer:b["a"],VDataTable:x["a"],VDialog:u["a"],VDivider:w["a"],VForm:A["a"],VIcon:D["a"],VImg:S["a"],VRow:k["a"],VSelect:y["a"],VSheet:I["a"],VSpacer:N["a"],VSwitch:O["a"],VTextField:V["a"],VToolbar:B["a"]})},d0cd:function(e,t,a){}}]);
//# sourceMappingURL=chunk-a695f170.60d86c4b.js.map